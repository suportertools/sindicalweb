<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:p="http://primefaces.org/ui">

    <h:head>
        <title>Sindical - Impressão de Boleto Social</title>
        <meta http-equiv="X-UA-Compatible" content="IE=9" />
        <link rel="shortcut icon" href="#{facesContext.externalContext.requestContextPath}/Imagens/favicon.ico"/>  
        <style type="text/css">
            .ui-widget-content .ui-inputfield{ padding: 8px!important;} 
            .ui-button { padding: 3px!important; }
            
            .ui-fileupload-buttonbar {
                background: transparent none;
                border: none;
            }

            .ui-fileupload-content {
                display: none;
            }

            .ui-fileupload-buttonbar .ui-fileupload-choose {
                background-color: rgba(142, 103, 64, 0.98);
            }
        </style>

        <script type="text/javascript">
            function stopRKey(evt) {
                var evt = (evt) ? evt : ((event) ? event : null);
                //var node = (evt.target) ? evt.target : ((evt.srcElement) ? evt.srcElement : null); 
                if (evt.keyCode === 13) {
                    return false;
                }
            }

            document.onkeypress = stopRKey;
        </script>
    </h:head>
    <h:body>
        <!-- INICIA DIV wrap e main -->
        <div id="wrapx">
            <div id="mainx">
                <!-- INICIA DIV wrap e main -->  
                <f:subview id="header">
                    <ui:include src="templates/templatePrime.xhtml"/>
                    <ui:include src="templates/templateStatus.xhtml"/>
                </f:subview>
                <f:view>
                    <p:ajaxStatus id="i_status" onstart="PF('i_dlg_modal').show()" onsuccess="PF('i_dlg_modal').hide()" />
                    <p:dialog modal="true" widgetVar="i_dlg_modal" header="Status" draggable="false" closable="false">  
                        <h:outputLabel value="Aguarde ..." />
                    </p:dialog>
                    <p:panel style="margin: 0 auto; border: 0; width: #{configuracaoBean.resolucao.tipoResolucao.tamanho}">
                        <h:outputText value="Impressão de Boleto Social" styleClass="fonteHeader" />
                        <h:form id="formImpressaoBoletoSocial">
                            <p:panel styleClass="fundoCinza" style="clear: both">
                                <h:outputLabel value="Opção Marcar" style="font-size: 12pt!important"/><br />
                                <h:panelGrid columns="11">
                                    <p:column>
                                        <h:outputLabel value="De" /><br />
                                        <p:inputText size="5" value="#{impressaoBoletoSocialBean.de}"/>
                                    </p:column>

                                    <p:column>
                                        <h:outputLabel value="Até" /><br />
                                        <p:inputText size="5" value="#{impressaoBoletoSocialBean.ate}"/>
                                    </p:column>

                                    <p:column>
                                        <br />
                                        <p:commandButton icon="ui-icon-check" action="#{impressaoBoletoSocialBean.marcar()}" update="tbl i_panel_quantidade" />
                                    </p:column>

                                    <p:column>
                                        <br />
                                        <p:commandButton icon="ui-icon-close" action="#{impressaoBoletoSocialBean.desmarcarTudo()}" update="tbl i_panel_quantidade" />
                                    </p:column>
                                    
                                    <p:column id="i_documento">
                                        <h:outputText value="Documento" /><br />
                                        <p:inputMask value="#{impressaoBoletoSocialBean.strDocumento}" mask="#{(impressaoBoletoSocialBean.tipo eq 'juridica') ? '99.999.999/9999-99' : '999.999.999-99'}" style="width: 140px"/>
                                    </p:column>

                                    <p:column>
                                        <h:outputLabel value="Responsável"/><br />
                                        <p:inputText value="#{impressaoBoletoSocialBean.strResponsavel}" style="width: 170px"/>
                                    </p:column>

                                    <p:column>
                                        <br />
                                        <p:selectOneMenu value="#{impressaoBoletoSocialBean.tipo}" style="padding-right: 20px">
                                            <p:ajax event="change" update="i_documento formImpressaoBoletoSocial" listener="#{impressaoBoletoSocialBean.loadLista()}" />
                                            <f:selectItem itemValue="fisica" itemLabel="Física" />
                                            <f:selectItem itemValue="juridica" itemLabel="Jurídica" />
                                        </p:selectOneMenu>
                                    </p:column>

                                    <p:column>
                                        <h:outputLabel value="Lote" /><br />
                                        <p:inputText value="#{impressaoBoletoSocialBean.strLote}" size="5"/>
                                    </p:column>

                                    <p:column>
                                        <h:outputLabel value="Qnt. Páginas" /><br />
                                        <p:selectOneMenu value="#{impressaoBoletoSocialBean.qntFolhas}" style="padding-right: 10px">
                                            <p:ajax event="change" update="@this tbl" listener="#{impressaoBoletoSocialBean.loadLista()}"/>
                                            <f:selectItem itemValue="0" itemLabel="Todas" />
                                            <f:selectItem itemValue="1" itemLabel="1 Página" />
                                            <f:selectItem itemValue="2" itemLabel="2 à 5 Páginas" />
                                            <f:selectItem itemValue="3" itemLabel="Mais de 5" />
                                        </p:selectOneMenu>
                                    </p:column>

                                    <p:column>
                                        <h:outputLabel value="Data Proc." /><br />
                                        <p:inputMask value="#{impressaoBoletoSocialBean.strData}" mask="99/99/9999" size="8" style="background: #ffc8c8; font-weight: bold"/>
                                    </p:column>

                                    <p:column>
                                        <br />
                                        <p:commandButton value="Filtrar" action="#{impressaoBoletoSocialBean.loadLista()}" update="formImpressaoBoletoSocial"/>
                                    </p:column>
                                </h:panelGrid>        
                            </p:panel>
                            <p:messages autoUpdate="false" closable="true" showDetail="true"/>
                            <p:growl autoUpdate="false" showDetail="true" />
                            <p:dataTable var="linha" id="tbl" value="#{impressaoBoletoSocialBean.listaGrid}" rowKey="#{linha.argumento0}" emptyMessage="Nenhum Boleto Encontrado!" paginator="true" rows="10">
                                <p:column headerText="" style="text-align: center; width: 40px">
                                    <p:commandLink value="#{linha.argumento0}" />
                                </p:column>

                                <p:column headerText=""  width="15" style="text-align: center">
                                    <p:selectBooleanCheckbox value="#{linha.argumento1}">
                                        <p:ajax event="change" update=":formImpressaoBoletoSocial:i_panel_quantidade" listener="#{impressaoBoletoSocialBean.atualizaValores}"/>
                                    </p:selectBooleanCheckbox>
                                </p:column>

                                <p:column headerText="Lote" style="text-align: center" width="30">
                                    <p:commandLink value="#{linha.argumento2[1]}"/>
                                </p:column>

                                <p:column headerText="Responsável">
                                    <p:commandLink value="#{linha.argumento2[2]}"/>
                                </p:column>

                                <p:column headerText="N Boleto" style="text-align: center" width="120">
                                    <p:commandLink value="#{linha.argumento2[3]}"/>
                                </p:column>

                                <p:column headerText="Proc." style="text-align: center" width="65">
                                    <p:commandLink value="#{linha.argumento2[5]}"/>
                                </p:column>

                                <p:column headerText="Vencto" style="text-align: center" width="65">
                                    <p:commandLink value="#{linha.argumento2[4]}"/>
                                </p:column>

                                <p:column headerText="Valor Total" width="65" >
                                    <p:commandLink value="#{linha.argumento3}" style="float: right"/>
                                </p:column>

                                <p:column headerText="Pag." style="width: 40px; text-align: center">
                                    <p:commandLink value="#{linha.argumento4}" />
                                </p:column>

                                <f:facet name="footer">
                                    <p:outputLabel value="O total de páginas não conta o verso" style="color: red"/>
                                </f:facet>
                            </p:dataTable>
                            <p:panel style="height: 55px">
                                <h:panelGrid id="i_panel_quantidade" columns="3" style="float: right; clear: both; width: 400px">
                                    <h:column>
                                        <p:outputLabel value="Linhas Selecionadas" /><br />
                                        <p:outputLabel value="#{impressaoBoletoSocialBean.qntPessoasSelecionadas}" style="font-weight: bold; font-size: 11pt!important"/> 
                                    </h:column>

                                    <h:column>
                                        <p:outputLabel value="Total de #{impressaoBoletoSocialBean.tipo == 'fisica' ? 'Físicas' : 'Empresas'}" /><br />
                                        <p:outputLabel value="#{impressaoBoletoSocialBean.listaGrid.size()}" style="font-weight: bold; font-size: 11pt!important"/> 
                                    </h:column>

                                    <h:column>
                                        <p:outputLabel value="Valor Total R$" /><br />
                                        <p:outputLabel value="#{impressaoBoletoSocialBean.valorTotal}" style="font-weight: bold; font-size: 11pt!important"/> 
                                    </h:column>
                                </h:panelGrid>
                            </p:panel>
                            <p:dataTable var="linha" id="tbl2" value="#{impressaoBoletoSocialBean.listaPessoaSemEndereco}" rendered="#{impressaoBoletoSocialBean.listaPessoaSemEndereco.size() > 0}">
                                <p:column headerText="PESSOAS SEM ENDEREÇO">
                                    <p:commandLink value="#{linha.nome}" action="#{impressaoBoletoSocialBean.editarPessoaSemEndereco(linha)}"/>
                                </p:column>
                            </p:dataTable>

                            <h:panelGrid columns="5">
                                <p:commandButton ajax="false" value="Imprimir" action="#{impressaoBoletoSocialBean.imprimir()}" onclick="this.form.target = '_blank'"/>
                                <p:selectBooleanCheckbox value="#{impressaoBoletoSocialBean.imprimeVerso}" style="margin-left: 30px" itemLabel="Imprimir Verso"/>
                                <p:commandButton ajax="false" value="Etiquetas" action="#{impressaoBoletoSocialBean.etiqueta()}" style="margin-left: 30px" onclick="this.form.target = '_blank'"/>
                                <p:commandButton ajax="false" value="Etiquetas para Contabilidade" action="#{impressaoBoletoSocialBean.etiquetaParaContabilidade()}" style="margin-left: 30px" onclick="this.form.target = '_blank'" rendered="#{impressaoBoletoSocialBean.tipo.equals('juridica')}"/>
                                <p:commandButton value="Alterar imagem do Boleto" onclick="PF('dlg_imagem').show()" style="float: right; margin-left: 20px" />
                            </h:panelGrid>


                        </h:form>

                        <h:form id="formUploadImagem" enctype="multipart/form-data" acceptcharset="UTF-8">
                            <p:dialog id="dlg_imagem" widgetVar="dlg_imagem" header="Imagem do Boleto" resizable="false" modal="true">
                                <p:graphicImage value="/Cliente/#{controleUsuarioBean.clienteString}/Imagens/BannerPromoBoleto.png" style="max-width: 500px" cache="false"/>

                                <h:panelGrid columns="3">
                                    <p:fileUpload label ="Alterar Imagem" 
                                                  mode="advanced" 
                                                  fileUploadListener="#{impressaoBoletoSocialBean.upload}" 
                                                  multiple="false" 
                                                  auto="true" 
                                                  allowTypes="/(\.|\/)(gif|jpe?g|png)$/" 
                                                  update="formUploadImagem"/>
                                </h:panelGrid>
                            </p:dialog>
                        </h:form>
                    </p:panel>
                </f:view>
                <!-- FINALIZA div wrap main -->
            </div>
        </div>
        <!-- FINALIZA div wrap main -->

        <div id="footerx">
            <f:subview id="footer">
                <ui:include src="templates/templateFooter.xhtml"/>
            </f:subview>
        </div>                
    </h:body>
</ui:composition>